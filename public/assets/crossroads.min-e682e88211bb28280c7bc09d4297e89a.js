!function(){var t=function(t){function e(t,e){if(t.indexOf)return t.indexOf(e);for(var i=t.length;i--;)if(t[i]===e)return i;return-1}function i(t,i){var n=e(t,i);-1!==n&&t.splice(n,1)}function n(t,e){return"[object "+e+"]"===Object.prototype.toString.call(t)}function s(t){return n(t,"RegExp")}function o(t){return n(t,"Array")}function a(t){return"function"==typeof t}function r(t){var e;return e=null===t||"null"===t?null:"true"===t?!0:"false"===t?!1:t===f||"undefined"===t?f:""===t||isNaN(t)?t:parseFloat(t)}function l(t){for(var e=t.length,i=[];e--;)i[e]=r(t[e]);return i}function c(t,e){for(var i,n,s=(t||"").replace("?","").split("&"),o=s.length,a={};o--;)i=s[o].split("="),n=e?r(i[1]):i[1],a[i[0]]="string"==typeof n?decodeURIComponent(n):n;return a}function h(){this.bypassed=new t.Signal,this.routed=new t.Signal,this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function u(e,i,n,o){var a=s(e),r=o.patternLexer;this._router=o,this._pattern=e,this._paramsIds=a?null:r.getParamIds(e),this._optionalParamsIds=a?null:r.getOptionalParamsIds(e),this._matchRegexp=a?e:r.compilePattern(e,o.ignoreCase),this.matched=new t.Signal,this.switched=new t.Signal,i&&this.matched.add(i),this._priority=n||0}var d,p,f;return p=""===/t(.+)?/.exec("t")[1],h.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(){return new h},addRoute:function(t,e,i){var n=new u(t,e,i,this);return this._sortedInsert(n),n},removeRoute:function(t){i(this._routes,t),t._destroy()},removeAllRoutes:function(){for(var t=this.getNumRoutes();t--;)this._routes[t]._destroy();this._routes.length=0},parse:function(t,e){if(t=t||"",e=e||[],this.ignoreState||t!==this._prevMatchedRequest&&t!==this._prevBypassedRequest){var i,n=this._getMatchedRoutes(t),s=0,o=n.length;if(o)for(this._prevMatchedRequest=t,this._notifyPrevRoutes(n,t),this._prevRoutes=n;o>s;)i=n[s],i.route.matched.dispatch.apply(i.route.matched,e.concat(i.params)),i.isFirst=!s,this.routed.dispatch.apply(this.routed,e.concat([t,i])),s+=1;else this._prevBypassedRequest=t,this.bypassed.dispatch.apply(this.bypassed,e.concat([t]));this._pipeParse(t,e)}},_notifyPrevRoutes:function(t,e){for(var i,n=0;i=this._prevRoutes[n++];)i.route.switched&&this._didSwitch(i.route,t)&&i.route.switched.dispatch(e)},_didSwitch:function(t,e){for(var i,n=0;i=e[n++];)if(i.route===t)return!1;return!0},_pipeParse:function(t,e){for(var i,n=0;i=this._piped[n++];)i.parse(t,e)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(t){var e=this._routes,i=e.length;do--i;while(e[i]&&t._priority<=e[i]._priority);e.splice(i+1,0,t)},_getMatchedRoutes:function(t){for(var e,i=[],n=this._routes,s=n.length;(e=n[--s])&&((!i.length||this.greedy||e.greedy)&&e.match(t)&&i.push({route:e,params:e._getParamsArray(t)}),this.greedyEnabled||!i.length););return i},pipe:function(t){this._piped.push(t)},unpipe:function(t){i(this._piped,t)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},d=new h,d.VERSION="0.12.0",d.NORM_AS_ARRAY=function(t,e){return[e.vals_]},d.NORM_AS_OBJECT=function(t,e){return[e]},u.prototype={greedy:!1,rules:void 0,match:function(t){return t=t||"",this._matchRegexp.test(t)&&this._validateParams(t)},_validateParams:function(t){var e,i=this.rules,n=this._getParamsObject(t);for(e in i)if("normalize_"!==e&&i.hasOwnProperty(e)&&!this._isValidParam(t,e,n))return!1;return!0},_isValidParam:function(t,i,n){var r=this.rules[i],l=n[i],c=!1,h=0===i.indexOf("?");return null==l&&this._optionalParamsIds&&-1!==e(this._optionalParamsIds,i)?c=!0:s(r)?(h&&(l=n[i+"_"]),c=r.test(l)):o(r)?(h&&(l=n[i+"_"]),c=this._isValidArrayRule(r,l)):a(r)&&(c=r(l,t,n)),c},_isValidArrayRule:function(t,i){if(!this._router.ignoreCase)return-1!==e(t,i);"string"==typeof i&&(i=i.toLowerCase());for(var n,s,o=t.length;o--;)if(n=t[o],s="string"==typeof n?n.toLowerCase():n,s===i)return!0;return!1},_getParamsObject:function(t){for(var i,n,s=this._router.shouldTypecast,o=this._router.patternLexer.getParamValues(t,this._matchRegexp,s),a={},l=o.length;l--;)n=o[l],this._paramsIds&&(i=this._paramsIds[l],0===i.indexOf("?")&&n&&(a[i+"_"]=n,n=c(n,s),o[l]=n),p&&""===n&&-1!==e(this._optionalParamsIds,i)&&(n=void 0,o[l]=n),a[i]=n),a[l]=n;return a.request_=s?r(t):t,a.vals_=o,a},_getParamsArray:function(t){var e,i=this.rules?this.rules.normalize_:null;return i=i||this._router.normalizeFn,e=i&&a(i)?i(t,this._getParamsObject(t)):this._getParamsObject(t).vals_},interpolate:function(t){var e=this._router.patternLexer.interpolate(this._pattern,t);if(!this._validateParams(e))throw new Error("Generated string doesn't validate against `Route.rules`.");return e},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},h.prototype.patternLexer=function(){function t(){var t,e;for(t in p)p.hasOwnProperty(t)&&(e=p[t],e.id="__CR_"+t+"__",e.save="save"in e?e.save.replace("{{id}}",e.id):e.id,e.rRestore=new RegExp(e.id,"g"))}function e(t,e){var i,n=[];for(t.lastIndex=0;i=t.exec(e);)n.push(i[1]);return n}function i(t){return e(d,t)}function n(t){return e(p.OP.rgx,t)}function s(t,e){return t=t||"",t&&(v===f?t=t.replace(h,""):v===m&&(t=t.replace(u,"")),t=o(t,"rgx","save"),t=t.replace(c,"\\$&"),t=o(t,"rRestore","res"),v===f&&(t="\\/?"+t)),v!==g&&(t+="\\/?"),new RegExp("^"+t+"$",e?"i":"")}function o(t,e,i){var n,s;for(s in p)p.hasOwnProperty(s)&&(n=p[s],t=t.replace(n[e],n[i]));return t}function a(t,e,i){var n=e.exec(t);return n&&(n.shift(),i&&(n=l(n))),n}function r(t,e){if("string"!=typeof t)throw new Error("Route pattern should be a string.");var i=function(t,i){var n;if(i="?"===i.substr(0,1)?i.substr(1):i,null!=e[i]){if("object"==typeof e[i]){var s=[];for(var o in e[i])s.push(encodeURI(o+"="+e[i][o]));n="?"+s.join("&")}else n=String(e[i]);if(-1===t.indexOf("*")&&-1!==n.indexOf("/"))throw new Error('Invalid value "'+n+'" for segment "'+t+'".')}else{if(-1!==t.indexOf("{"))throw new Error("The segment "+t+" is required.");n=""}return n};return p.OS.trail||(p.OS.trail=new RegExp("(?:"+p.OS.id+")+$")),t.replace(p.OS.rgx,p.OS.save).replace(d,i).replace(p.OS.trail,"").replace(p.OS.rRestore,"/")}var c=/[\\.+*?\^$\[\](){}\/'#]/g,h=/^\/|\/$/g,u=/\/$/g,d=/(?:\{|:)([^}:]+)(?:\}|:)/g,p={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},f=1,g=2,m=3,v=f;return t(),{strict:function(){v=g},loose:function(){v=f},legacy:function(){v=m},getParamIds:i,getOptionalParamsIds:n,getParamValues:a,compilePattern:s,interpolate:r}}(),d};"function"==typeof define&&define.amd?define(["signals"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("signals")):window.crossroads=t(window.signals)}();