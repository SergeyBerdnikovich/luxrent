!function(t){t.Jcrop=function(e,i){function n(t){return Math.round(t)+"px"}function s(t){return O.baseClass+"-"+t}function o(){return t.fx.step.hasOwnProperty("backgroundColor")}function a(e){var i=t(e).offset();return[i.left,i.top]}function r(t){return[t.pageX-H[0],t.pageY-H[1]]}function l(e){"object"!=typeof e&&(e={}),O=t.extend(O,e),t.each(["onChange","onSelect","onRelease","onDblClick"],function(t,e){"function"!=typeof O[e]&&(O[e]=function(){})})}function c(t,e,i){if(H=a(B),fe.setCursor("move"===t?t:t+"-resize"),"move"===t)return fe.activateHandlers(u(e),m,i);var n=ue.getFixed(),s=d(t),o=ue.getCorner(d(s));ue.setPressed(ue.getCorner(s)),ue.setCurrent(o),fe.activateHandlers(h(t,n),m,i)}function h(t,e){return function(i){if(O.aspectRatio)switch(t){case"e":i[1]=e.y+1;break;case"w":i[1]=e.y+1;break;case"n":i[0]=e.x+1;break;case"s":i[0]=e.x+1}else switch(t){case"e":i[1]=e.y2;break;case"w":i[1]=e.y2;break;case"n":i[0]=e.x2;break;case"s":i[0]=e.x2}ue.setCurrent(i),pe.update()}}function u(t){var e=t;return ge.watchKeys(),function(t){ue.moveOffset([t[0]-e[0],t[1]-e[1]]),e=t,pe.update()}}function d(t){switch(t){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function p(t){return function(e){return O.disabled?!1:"move"!==t||O.allowMove?(H=a(B),ne=!0,c(t,r(e)),e.stopPropagation(),e.preventDefault(),!1):!1}}function f(t,e,i){var n=t.width(),s=t.height();n>e&&e>0&&(n=e,s=e/t.width()*t.height()),s>i&&i>0&&(s=i,n=i/t.height()*t.width()),ee=t.width()/n,ie=t.height()/s,t.width(n).height(s)}function g(t){return{x:t.x*ee,y:t.y*ie,x2:t.x2*ee,y2:t.y2*ie,w:t.w*ee,h:t.h*ie}}function m(){var t=ue.getFixed();t.w>O.minSelect[0]&&t.h>O.minSelect[1]?(pe.enableHandles(),pe.done()):pe.release(),fe.setCursor(O.allowSelect?"crosshair":"default")}function v(t){if(O.disabled)return!1;if(!O.allowSelect)return!1;ne=!0,H=a(B),pe.disableHandles(),fe.setCursor("crosshair");var e=r(t);return ue.setPressed(e),pe.update(),fe.activateHandlers(y,m,"touch"===t.type.substring(0,5)),ge.watchKeys(),t.stopPropagation(),t.preventDefault(),!1}function y(t){ue.setCurrent(t),pe.update()}function b(){var e=t("<div></div>").addClass(s("tracker"));return $&&e.css({opacity:0,backgroundColor:"white"}),e}function _(t){Q.removeClass().addClass(s("holder")).addClass(t)}function w(t,e){function i(){window.setTimeout(y,u)}var n=t[0]/ee,s=t[1]/ie,o=t[2]/ee,a=t[3]/ie;if(!se){var r=ue.flipCoords(n,s,o,a),l=ue.getFixed(),c=[l.x,l.y,l.x2,l.y2],h=c,u=O.animationDelay,d=r[0]-c[0],p=r[1]-c[1],f=r[2]-c[2],g=r[3]-c[3],m=0,v=O.swingSpeed;n=h[0],s=h[1],o=h[2],a=h[3],pe.animMode(!0);var y=function(){return function(){m+=(100-m)/v,h[0]=Math.round(n+m/100*d),h[1]=Math.round(s+m/100*p),h[2]=Math.round(o+m/100*f),h[3]=Math.round(a+m/100*g),m>=99.8&&(m=100),100>m?(C(h),i()):(pe.done(),pe.animMode(!1),"function"==typeof e&&e.call(me))}}();i()}}function x(t){C([t[0]/ee,t[1]/ie,t[2]/ee,t[3]/ie]),O.onSelect.call(me,g(ue.getFixed())),pe.enableHandles()}function C(t){ue.setPressed([t[0],t[1]]),ue.setCurrent([t[2],t[3]]),pe.update()}function k(){return g(ue.getFixed())}function T(){return ue.getFixed()}function D(t){l(t),N()}function S(){O.disabled=!0,pe.disableHandles(),pe.setCursor("default"),fe.setCursor("default")}function P(){O.disabled=!1,N()}function A(){pe.done(),fe.activateHandlers(null,null)}function I(){Q.remove(),L.show(),L.css("visibility","visible"),t(e).removeData("Jcrop")}function M(t,e){pe.release(),S();var i=new Image;i.onload=function(){var n=i.width,s=i.height,o=O.boxWidth,a=O.boxHeight;B.width(n).height(s),B.attr("src",t),U.attr("src",t),f(B,o,a),q=B.width(),Y=B.height(),U.width(q).height(Y),re.width(q+2*ae).height(Y+2*ae),Q.width(q).height(Y),de.resize(q,Y),P(),"function"==typeof e&&e.call(me)},i.src=t}function E(t,e,i){var n=e||O.bgColor;O.bgFade&&o()&&O.fadeTime&&!i?t.animate({backgroundColor:n},{queue:!1,duration:O.fadeTime}):t.css("backgroundColor",n)}function N(t){O.allowResize?t?pe.enableOnly():pe.enableHandles():pe.disableHandles(),fe.setCursor(O.allowSelect?"crosshair":"default"),pe.setCursor(O.allowMove?"move":"default"),O.hasOwnProperty("trueSize")&&(ee=O.trueSize[0]/q,ie=O.trueSize[1]/Y),O.hasOwnProperty("setSelect")&&(x(O.setSelect),pe.done(),delete O.setSelect),de.refresh(),O.bgColor!=le&&(E(O.shade?de.getShades():Q,O.shade?O.shadeColor||O.bgColor:O.bgColor),le=O.bgColor),ce!=O.bgOpacity&&(ce=O.bgOpacity,O.shade?de.refresh():pe.setBgOpacity(ce)),G=O.maxSize[0]||0,J=O.maxSize[1]||0,Z=O.minSize[0]||0,te=O.minSize[1]||0,O.hasOwnProperty("outerImage")&&(B.attr("src",O.outerImage),delete O.outerImage),pe.refresh()}var H,O=t.extend({},t.Jcrop.defaults),z=navigator.userAgent.toLowerCase(),$=/msie/.test(z),j=/msie [1-6]\./.test(z);"object"!=typeof e&&(e=t(e)[0]),"object"!=typeof i&&(i={}),l(i);var W={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},L=t(e),R=!0;if("IMG"==e.tagName){if(0!=L[0].width&&0!=L[0].height)L.width(L[0].width),L.height(L[0].height);else{var F=new Image;F.src=L[0].src,L.width(F.width),L.height(F.height)}var B=L.clone().removeAttr("id").css(W).show();B.width(L.width()),B.height(L.height()),L.after(B).hide()}else B=L.css(W).show(),R=!1,null===O.shade&&(O.shade=!0);f(B,O.boxWidth,O.boxHeight);var q=B.width(),Y=B.height(),Q=t("<div />").width(q).height(Y).addClass(s("holder")).css({position:"relative",backgroundColor:O.bgColor}).insertAfter(L).append(B);O.addClass&&Q.addClass(O.addClass);var U=t("<div />"),X=t("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),V=t("<div />").width("100%").height("100%").css("zIndex",320),K=t("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var t=ue.getFixed();O.onDblClick.call(me,t)}).insertBefore(B).append(X,V);R&&(U=t("<img />").attr("src",B.attr("src")).css(W).width(q).height(Y),X.append(U)),j&&K.css({overflowY:"hidden"});var G,J,Z,te,ee,ie,ne,se,oe,ae=O.boundary,re=b().width(q+2*ae).height(Y+2*ae).css({position:"absolute",top:n(-ae),left:n(-ae),zIndex:290}).mousedown(v),le=O.bgColor,ce=O.bgOpacity;H=a(B);var he=function(){function t(){var t,e={},i=["touchstart","touchmove","touchend"],n=document.createElement("div");try{for(t=0;t<i.length;t++){var s=i[t];s="on"+s;var o=s in n;o||(n.setAttribute(s,"return;"),o="function"==typeof n[s]),e[i[t]]=o}return e.touchstart&&e.touchend&&e.touchmove}catch(a){return!1}}function e(){return O.touchSupport===!0||O.touchSupport===!1?O.touchSupport:t()}return{createDragger:function(t){return function(e){return O.disabled?!1:"move"!==t||O.allowMove?(H=a(B),ne=!0,c(t,r(he.cfilter(e)),!0),e.stopPropagation(),e.preventDefault(),!1):!1}},newSelection:function(t){return v(he.cfilter(t))},cfilter:function(t){return t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t},isSupported:t,support:e()}}(),ue=function(){function t(t){t=a(t),f=d=t[0],g=p=t[1]}function e(t){t=a(t),h=t[0]-f,u=t[1]-g,f=t[0],g=t[1]}function i(){return[h,u]}function n(t){var e=t[0],i=t[1];0>d+e&&(e-=e+d),0>p+i&&(i-=i+p),g+i>Y&&(i+=Y-(g+i)),f+e>q&&(e+=q-(f+e)),d+=e,f+=e,p+=i,g+=i}function s(t){var e=o();switch(t){case"ne":return[e.x2,e.y];case"nw":return[e.x,e.y];case"se":return[e.x2,e.y2];case"sw":return[e.x,e.y2]}}function o(){if(!O.aspectRatio)return l();var t,e,i,n,s=O.aspectRatio,o=O.minSize[0]/ee,a=O.maxSize[0]/ee,h=O.maxSize[1]/ie,u=f-d,m=g-p,v=Math.abs(u),y=Math.abs(m),b=v/y;return 0===a&&(a=10*q),0===h&&(h=10*Y),s>b?(e=g,i=y*s,t=0>u?d-i:i+d,0>t?(t=0,n=Math.abs((t-d)/s),e=0>m?p-n:n+p):t>q&&(t=q,n=Math.abs((t-d)/s),e=0>m?p-n:n+p)):(t=f,n=v/s,e=0>m?p-n:p+n,0>e?(e=0,i=Math.abs((e-p)*s),t=0>u?d-i:i+d):e>Y&&(e=Y,i=Math.abs(e-p)*s,t=0>u?d-i:i+d)),t>d?(o>t-d?t=d+o:t-d>a&&(t=d+a),e=e>p?p+(t-d)/s:p-(t-d)/s):d>t&&(o>d-t?t=d-o:d-t>a&&(t=d-a),e=e>p?p+(d-t)/s:p-(d-t)/s),0>t?(d-=t,t=0):t>q&&(d-=t-q,t=q),0>e?(p-=e,e=0):e>Y&&(p-=e-Y,e=Y),c(r(d,p,t,e))}function a(t){return t[0]<0&&(t[0]=0),t[1]<0&&(t[1]=0),t[0]>q&&(t[0]=q),t[1]>Y&&(t[1]=Y),[Math.round(t[0]),Math.round(t[1])]}function r(t,e,i,n){var s=t,o=i,a=e,r=n;return t>i&&(s=i,o=t),e>n&&(a=n,r=e),[s,a,o,r]}function l(){var t,e=f-d,i=g-p;return G&&Math.abs(e)>G&&(f=e>0?d+G:d-G),J&&Math.abs(i)>J&&(g=i>0?p+J:p-J),te/ie&&Math.abs(i)<te/ie&&(g=i>0?p+te/ie:p-te/ie),Z/ee&&Math.abs(e)<Z/ee&&(f=e>0?d+Z/ee:d-Z/ee),0>d&&(f-=d,d-=d),0>p&&(g-=p,p-=p),0>f&&(d-=f,f-=f),0>g&&(p-=g,g-=g),f>q&&(t=f-q,d-=t,f-=t),g>Y&&(t=g-Y,p-=t,g-=t),d>q&&(t=d-Y,g-=t,p-=t),p>Y&&(t=p-Y,g-=t,p-=t),c(r(d,p,f,g))}function c(t){return{x:t[0],y:t[1],x2:t[2],y2:t[3],w:t[2]-t[0],h:t[3]-t[1]}}var h,u,d=0,p=0,f=0,g=0;return{flipCoords:r,setPressed:t,setCurrent:e,getOffset:i,moveOffset:n,getCorner:s,getFixed:o}}(),de=function(){function e(t,e){f.left.css({height:n(e)}),f.right.css({height:n(e)})}function i(){return s(ue.getFixed())}function s(t){f.top.css({left:n(t.x),width:n(t.w),height:n(t.y)}),f.bottom.css({top:n(t.y2),left:n(t.x),width:n(t.w),height:n(Y-t.y2)}),f.right.css({left:n(t.x2),width:n(q-t.x2)}),f.left.css({width:n(t.x)})}function o(){return t("<div />").css({position:"absolute",backgroundColor:O.shadeColor||O.bgColor}).appendTo(p)}function a(){d||(d=!0,p.insertBefore(B),i(),pe.setBgOpacity(1,0,1),U.hide(),r(O.shadeColor||O.bgColor,1),pe.isAwake()?c(O.bgOpacity,1):c(1,1))}function r(t,e){E(u(),t,e)}function l(){d&&(p.remove(),U.show(),d=!1,pe.isAwake()?pe.setBgOpacity(O.bgOpacity,1,1):(pe.setBgOpacity(1,1,1),pe.disableHandles()),E(Q,0,1))}function c(t,e){d&&(O.bgFade&&!e?p.animate({opacity:1-t},{queue:!1,duration:O.fadeTime}):p.css({opacity:1-t}))}function h(){O.shade?a():l(),pe.isAwake()&&c(O.bgOpacity)}function u(){return p.children()}var d=!1,p=t("<div />").css({position:"absolute",zIndex:240,opacity:0}),f={top:o(),left:o().height(Y),right:o().height(Y),bottom:o()};return{update:i,updateRaw:s,getShades:u,setBgColor:r,enable:a,disable:l,resize:e,refresh:h,opacity:c}}(),pe=function(){function e(e){var i=t("<div />").css({position:"absolute",opacity:O.borderOpacity}).addClass(s(e));return X.append(i),i}function i(e,i){var n=t("<div />").mousedown(p(e)).css({cursor:e+"-resize",position:"absolute",zIndex:i}).addClass("ord-"+e);return he.support&&n.bind("touchstart.jcrop",he.createDragger(e)),V.append(n),n}function o(t){var e=O.handleSize,n=i(t,S++).css({opacity:O.handleOpacity}).addClass(s("handle"));return e&&n.width(e).height(e),n}function a(t){return i(t,S++).addClass("jcrop-dragbar")}function r(t){var e;for(e=0;e<t.length;e++)I[t[e]]=a(t[e])}function l(t){var i,n;for(n=0;n<t.length;n++){switch(t[n]){case"n":i="hline";break;case"s":i="hline bottom";break;case"e":i="vline right";break;case"w":i="vline"}P[t[n]]=e(i)}}function c(t){var e;for(e=0;e<t.length;e++)A[t[e]]=o(t[e])}function h(t,e){O.shade||U.css({top:n(-e),left:n(-t)}),K.css({top:n(e),left:n(t)})}function u(t,e){K.width(Math.round(t)).height(Math.round(e))}function d(){var t=ue.getFixed();ue.setPressed([t.x,t.y]),ue.setCurrent([t.x2,t.y2]),f()}function f(t){return D?m(t):void 0}function m(t){var e=ue.getFixed();u(e.w,e.h),h(e.x,e.y),O.shade&&de.updateRaw(e),D||y(),t?O.onSelect.call(me,g(e)):O.onChange.call(me,g(e))}function v(t,e,i){(D||e)&&(O.bgFade&&!i?B.animate({opacity:t},{queue:!1,duration:O.fadeTime}):B.css("opacity",t))}function y(){K.show(),O.shade?de.opacity(ce):v(ce,!0),D=!0}function _(){C(),K.hide(),O.shade?de.opacity(1):v(1),D=!1,O.onRelease.call(me)}function w(){M&&V.show()}function x(){return M=!0,O.allowResize?(V.show(),!0):void 0}function C(){M=!1,V.hide()}function k(t){t?(se=!0,C()):(se=!1,x())}function T(){k(!1),d()}var D,S=370,P={},A={},I={},M=!1;O.dragEdges&&t.isArray(O.createDragbars)&&r(O.createDragbars),t.isArray(O.createHandles)&&c(O.createHandles),O.drawBorders&&t.isArray(O.createBorders)&&l(O.createBorders),t(document).bind("touchstart.jcrop-ios",function(e){t(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var E=b().mousedown(p("move")).css({cursor:"move",position:"absolute",zIndex:360});return he.support&&E.bind("touchstart.jcrop",he.createDragger("move")),X.append(E),C(),{updateVisible:f,update:m,release:_,refresh:d,isAwake:function(){return D},setCursor:function(t){E.css("cursor",t)},enableHandles:x,enableOnly:function(){M=!0},showHandles:w,disableHandles:C,animMode:k,setBgOpacity:v,done:T}}(),fe=function(){function e(e){re.css({zIndex:450}),e?t(document).bind("touchmove.jcrop",a).bind("touchend.jcrop",l):d&&t(document).bind("mousemove.jcrop",n).bind("mouseup.jcrop",s)}function i(){re.css({zIndex:290}),t(document).unbind(".jcrop")}function n(t){return h(r(t)),!1}function s(t){return t.preventDefault(),t.stopPropagation(),ne&&(ne=!1,u(r(t)),pe.isAwake()&&O.onSelect.call(me,g(ue.getFixed())),i(),h=function(){},u=function(){}),!1}function o(t,i,n){return ne=!0,h=t,u=i,e(n),!1}function a(t){return h(r(he.cfilter(t))),!1}function l(t){return s(he.cfilter(t))}function c(t){re.css("cursor",t)}var h=function(){},u=function(){},d=O.trackDocument;return d||re.mousemove(n).mouseup(s).mouseout(s),B.before(re),{activateHandlers:o,setCursor:c}}(),ge=function(){function e(){O.keySupport&&(o.show(),o.focus())}function i(){o.hide()}function n(t,e,i){O.allowMove&&(ue.moveOffset([e,i]),pe.updateVisible(!0)),t.preventDefault(),t.stopPropagation()}function s(t){if(t.ctrlKey||t.metaKey)return!0;oe=t.shiftKey?!0:!1;var e=oe?10:1;switch(t.keyCode){case 37:n(t,-e,0);break;case 39:n(t,e,0);break;case 38:n(t,0,-e);break;case 40:n(t,0,e);break;case 27:O.allowSelect&&pe.release();break;case 9:return!0}return!1}var o=t('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),a=t("<div />").css({position:"absolute",overflow:"hidden"}).append(o);return O.keySupport&&(o.keydown(s).blur(i),j||!O.fixedSupport?(o.css({position:"absolute",left:"-20px"}),a.append(o).insertBefore(B)):o.insertBefore(B)),{watchKeys:e}}();he.support&&re.bind("touchstart.jcrop",he.newSelection),V.hide(),N(!0);var me={setImage:M,animateTo:w,setSelect:x,setOptions:D,tellSelect:k,tellScaled:T,setClass:_,disable:S,enable:P,cancel:A,release:pe.release,destroy:I,focus:ge.watchKeys,getBounds:function(){return[q*ee,Y*ie]},getWidgetSize:function(){return[q,Y]},getScaleFactor:function(){return[ee,ie]},getOptions:function(){return O},ui:{holder:Q,selection:K}};return $&&Q.bind("selectstart",function(){return!1}),L.data("Jcrop",me),me},t.fn.Jcrop=function(e,i){var n;return this.each(function(){if(t(this).data("Jcrop")){if("api"===e)return t(this).data("Jcrop");t(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?t.Jcrop.Loader(this,function(){t(this).css({display:"block",visibility:"hidden"}),n=t.Jcrop(this,e),t.isFunction(i)&&i.call(n)}):(t(this).css({display:"block",visibility:"hidden"}),n=t.Jcrop(this,e),t.isFunction(i)&&i.call(n))}),this},t.Jcrop.Loader=function(e,i,n){function s(){a.complete?(o.unbind(".jcloader"),t.isFunction(i)&&i.call(a)):window.setTimeout(s,50)}var o=t(e),a=o[0];o.bind("load.jcloader",s).bind("error.jcloader",function(){o.unbind(".jcloader"),t.isFunction(n)&&n.call(a)}),a.complete&&t.isFunction(i)&&(o.unbind(".jcloader"),i.call(a))},t.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);